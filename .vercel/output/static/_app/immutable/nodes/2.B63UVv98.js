import{s as V,f as Q,n as N,r as Y,c as Z,h as H}from"../chunks/scheduler.Rzn6huuy.js";import{S as X,i as J,e as v,s as U,c as T,a as L,k as S,f as I,d as y,l as f,g as k,h as x,z as F,n as O,p as tt,m as D,r as et,t as $,v as at,b as M,w as nt,x as st,j as W,y as ot,A as lt}from"../chunks/index.D6xxGKKq.js";import{p as rt,i as it,a as ct,w as ut,b as K}from"../chunks/entry.CPY-eWrb.js";import{p as dt}from"../chunks/stores.CgIKrO6n.js";function j(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function ft(s){const t=JSON.parse(s);return t.data&&(t.data=rt(t.data)),t}function z(s){return HTMLElement.prototype.cloneNode.call(s)}function mt(s,t=()=>{}){const o=async({action:e,result:m,reset:r=!0,invalidateAll:i=!0})=>{m.type==="success"&&(r&&HTMLFormElement.prototype.reset.call(s),i&&await it()),(location.origin+location.pathname===e.origin+e.pathname||m.type==="redirect"||m.type==="error")&&ct(m)};async function n(e){var w,E,C,h;if(((w=e.submitter)!=null&&w.hasAttribute("formmethod")?e.submitter.formMethod:z(s).method)!=="post")return;e.preventDefault();const r=new URL((E=e.submitter)!=null&&E.hasAttribute("formaction")?e.submitter.formAction:z(s).action),i=new FormData(s),c=(C=e.submitter)==null?void 0:C.getAttribute("name");c&&i.append(c,((h=e.submitter)==null?void 0:h.getAttribute("value"))??"");const l=new AbortController;let d=!1;const b=await t({action:r,cancel:()=>d=!0,controller:l,formData:i,formElement:s,submitter:e.submitter})??o;if(d)return;let g;try{const a=await fetch(r,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:i,signal:l.signal});g=ft(await a.text()),g.type==="error"&&(g.status=a.status)}catch(a){if((a==null?void 0:a.name)==="AbortError")return;g={type:"error",error:a}}b({action:r,formData:i,formElement:s,update:a=>o({action:r,result:g,reset:a==null?void 0:a.reset,invalidateAll:a==null?void 0:a.invalidateAll}),result:g})}return HTMLFormElement.prototype.addEventListener.call(s,"submit",n),{destroy(){HTMLFormElement.prototype.removeEventListener.call(s,"submit",n)}}}function ht(s){let t,o,n,e="Todo",m,r,i,c,l,d,p,b,g="Submit",w,E;return{c(){t=v("form"),o=v("div"),n=v("label"),n.textContent=e,m=U(),r=v("input"),i=U(),c=v("input"),l=U(),d=v("input"),p=U(),b=v("button"),b.textContent=g,this.h()},l(C){t=T(C,"FORM",{class:!0,action:!0,method:!0,enctype:!0});var h=L(t);o=T(h,"DIV",{class:!0});var a=L(o);n=T(a,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),S(n)!=="svelte-1vd8zs6"&&(n.textContent=e),m=I(a),r=T(a,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,class:!0,autocomplete:!0}),i=I(a),c=T(a,"INPUT",{type:!0,name:!0}),l=I(a),d=T(a,"INPUT",{type:!0,accept:!0,class:!0,id:!0}),a.forEach(y),p=I(h),b=T(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),S(b)!=="svelte-17lmbkk"&&(b.textContent=g),h.forEach(y),this.h()},h(){f(n,"for","todo"),f(n,"class","font-bold mb-2 text-gray-800"),f(r,"type","text"),f(r,"name","text"),f(r,"id","text"),f(r,"placeholder","What you gonna do?"),f(r,"class","appearance-none shadow-sm border border-gray-200 p-2 focus:outline-none focus:border-gray-500 rounded-lg"),f(r,"autocomplete","off"),f(c,"type","hidden"),f(c,"name","image"),c.value=s[0],f(d,"type","file"),f(d,"accept","image/*"),f(d,"class","w-full shadow-sm rounded bg-gray-500 hover:bg-gray-600 text-white py-2 px-4"),f(d,"id","image"),f(o,"class","flex flex-col text-sm mb-2 space-y-2"),f(b,"type","submit"),f(b,"class","w-full shadow-sm rounded bg-blue-500 hover:bg-blue-600 text-white py-2 px-4"),f(t,"class","my-6"),f(t,"action","?/createTodo"),f(t,"method","post"),f(t,"enctype","multipart/form-data")},m(C,h){k(C,t,h),x(t,o),x(o,n),x(o,m),x(o,r),x(o,i),x(o,c),x(o,l),x(o,d),x(t,p),x(t,b),w||(E=[F(d,"change",s[1]),Q(mt.call(null,t))],w=!0)},p(C,[h]){h&1&&(c.value=C[0])},i:N,o:N,d(C){C&&y(t),w=!1,Y(E)}}}function pt(s,t,o){let{baseImage:n=ut("")}=t,e;const m=async i=>{var d;const l=(d=i.target.files)==null?void 0:d[0];if(!l)return"error in convert image to base64";o(0,e=await r(l)),n.set(e)},r=i=>new Promise((c,l)=>{const d=new FileReader;d.readAsDataURL(i),d.onload=()=>{d.result&&typeof d.result=="string"?c(d.result):l(new Error("Failed to read file as Data URL."))},d.onerror=p=>{l(p)}});return s.$$set=i=>{"baseImage"in i&&o(2,n=i.baseImage)},[e,m,n]}class bt extends X{constructor(t){super(),J(this,t,pt,ht,V,{baseImage:2})}}async function gt(s,t,o){const{callbackUrl:n=window.location.href,redirect:e=!0}=t??{},m=s==="credentials",i=m||s==="email",c=K??"",d=`${`${c}/auth/${m?"callback":"signin"}/${s}`}?${new URLSearchParams(o)}`,p=await fetch(`${c}/auth/csrf`),{csrfToken:b}=await p.json(),g=await fetch(d,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({...t,csrfToken:b,callbackUrl:n})}),w=await g.clone().json();if(e||!i){window.location.href=w.url??n,w.url.includes("#")&&window.location.reload();return}return g}async function wt(s){const{callbackUrl:t=window.location.href}=s??{},o=K??"",n=await fetch(`${o}/auth/csrf`),{csrfToken:e}=await n.json(),i=(await(await fetch(`${o}/auth/signout`,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Auth-Return-Redirect":"1"},body:new URLSearchParams({csrfToken:e,callbackUrl:t})})).json()).url??t;window.location.href=i,i.includes("#")&&window.location.reload()}function q(s,t,o){const n=s.slice();return n[5]=t[o],n}function xt(s){let t,o="Sign In",n,e,m="Sign In with GitHub",r,i;return{c(){t=v("h1"),t.textContent=o,n=U(),e=v("button"),e.textContent=m,this.h()},l(c){t=T(c,"H1",{class:!0,"data-svelte-h":!0}),S(t)!=="svelte-li3w2t"&&(t.textContent=o),n=I(c),e=T(c,"BUTTON",{class:!0,"data-svelte-h":!0}),S(e)!=="svelte-1gdgxqv"&&(e.textContent=m),this.h()},h(){f(t,"class","text-2xl font-bold text-center text-gray-800 md:text-3xl"),f(e,"class","bg-gray-700 py-1 px-2 rounded text-white")},m(c,l){k(c,t,l),k(c,n,l),k(c,e,l),r||(i=F(e,"click",s[4]),r=!0)},p:N,i:N,o:N,d(c){c&&(y(t),y(n),y(e)),r=!1,i()}}}function yt(s){var P;let t,o,n=((P=s[1].data.session.user)==null?void 0:P.name)+"",e,m,r,i="My todos",c,l,d,p,b,g="Sign Out",w,E,C;l=new bt({});let h=j(s[0]),a=[];for(let u=0;u<h.length;u+=1)a[u]=G(q(s,h,u));return{c(){t=v("p"),o=$("Signed in as "),e=$(n),m=U(),r=v("h1"),r.textContent=i,c=U(),at(l.$$.fragment),d=U();for(let u=0;u<a.length;u+=1)a[u].c();p=U(),b=v("button"),b.textContent=g,this.h()},l(u){t=T(u,"P",{});var _=L(t);o=M(_,"Signed in as "),e=M(_,n),_.forEach(y),m=I(u),r=T(u,"H1",{class:!0,"data-svelte-h":!0}),S(r)!=="svelte-9u0k6o"&&(r.textContent=i),c=I(u),nt(l.$$.fragment,u),d=I(u);for(let R=0;R<a.length;R+=1)a[R].l(u);p=I(u),b=T(u,"BUTTON",{class:!0,"data-svelte-h":!0}),S(b)!=="svelte-e2fbar"&&(b.textContent=g),this.h()},h(){f(r,"class","text-2xl font-bold text-center text-gray-800 md:text-3xl"),f(b,"class","bg-gray-700 py-1 px-2 rounded text-white")},m(u,_){k(u,t,_),x(t,o),x(t,e),k(u,m,_),k(u,r,_),k(u,c,_),st(l,u,_),k(u,d,_);for(let R=0;R<a.length;R+=1)a[R]&&a[R].m(u,_);k(u,p,_),k(u,b,_),w=!0,E||(C=F(b,"click",s[3]),E=!0)},p(u,_){var R;if((!w||_&2)&&n!==(n=((R=u[1].data.session.user)==null?void 0:R.name)+"")&&W(e,n),_&1){h=j(u[0]);let A;for(A=0;A<h.length;A+=1){const B=q(u,h,A);a[A]?a[A].p(B,_):(a[A]=G(B),a[A].c(),a[A].m(p.parentNode,p))}for(;A<a.length;A+=1)a[A].d(1);a.length=h.length}},i(u){w||(D(l.$$.fragment,u),w=!0)},o(u){O(l.$$.fragment,u),w=!1},d(u){u&&(y(t),y(m),y(r),y(c),y(d),y(p),y(b)),ot(l,u),lt(a,u),E=!1,C()}}}function G(s){let t,o,n,e,m,r=s[5].text+"",i,c,l,d,p,b,g,w,E="Delete",C;return{c(){t=v("li"),o=v("img"),e=U(),m=v("span"),i=$(r),c=U(),l=v("a"),d=$("Edit"),b=U(),g=v("form"),w=v("button"),w.textContent=E,this.h()},l(h){t=T(h,"LI",{class:!0});var a=L(t);o=T(a,"IMG",{src:!0,alt:!0,class:!0}),e=I(a),m=T(a,"SPAN",{class:!0});var P=L(m);i=M(P,r),P.forEach(y),c=I(a),l=T(a,"A",{href:!0,role:!0,class:!0});var u=L(l);d=M(u,"Edit"),u.forEach(y),b=I(a),g=T(a,"FORM",{action:!0,method:!0});var _=L(g);w=T(_,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),S(w)!=="svelte-5bceyc"&&(w.textContent=E),_.forEach(y),a.forEach(y),this.h()},h(){H(o.src,n=s[5].image)||f(o,"src",n),f(o,"alt","base64_image"),f(o,"class","size-10"),f(m,"class","flex-1 text-gray-800"),f(l,"href",p="/update/"+s[5].id),f(l,"role","button"),f(l,"class","text-sm bg-gray-500 hover:bg-gray-600 text-white py-1 px-2 rounded focus:outline-none focus:shadow-outline"),f(w,"type","submit"),f(w,"class","text-sm bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded focus:outline-none focus:shadow-outline"),f(g,"action",C="?/deleteTodo&id="+s[5].id),f(g,"method","post"),f(t,"class","bg-white flex space-x-3 items-center shadow-sm border border-gray-200 rounded-lg my-2 py-2 px-4 ")},m(h,a){k(h,t,a),x(t,o),x(t,e),x(t,m),x(m,i),x(t,c),x(t,l),x(l,d),x(t,b),x(t,g),x(g,w)},p(h,a){a&1&&!H(o.src,n=h[5].image)&&f(o,"src",n),a&1&&r!==(r=h[5].text+"")&&W(i,r),a&1&&p!==(p="/update/"+h[5].id)&&f(l,"href",p),a&1&&C!==(C="?/deleteTodo&id="+h[5].id)&&f(g,"action",C)},d(h){h&&y(t)}}}function _t(s){let t,o,n,e,m;const r=[yt,xt],i=[];function c(l,d){return l[1].data.session?0:1}return n=c(s),e=i[n]=r[n](s),{c(){t=v("main"),o=v("div"),e.c()},l(l){t=T(l,"MAIN",{});var d=L(t);o=T(d,"DIV",{});var p=L(o);e.l(p),p.forEach(y),d.forEach(y)},m(l,d){k(l,t,d),x(t,o),i[n].m(o,null),m=!0},p(l,[d]){let p=n;n=c(l),n===p?i[n].p(l,d):(et(),O(i[p],1,1,()=>{i[p]=null}),tt(),e=i[n],e?e.p(l,d):(e=i[n]=r[n](l),e.c()),D(e,1),e.m(o,null))},i(l){m||(D(e),m=!0)},o(l){O(e),m=!1},d(l){l&&y(t),i[n].d()}}}function vt(s,t,o){let n,e;Z(s,dt,c=>o(1,e=c));let{data:m}=t;const r=()=>wt(),i=()=>gt("github");return s.$$set=c=>{"data"in c&&o(2,m=c.data)},s.$$.update=()=>{s.$$.dirty&4&&o(0,{todos:n}=m,n)},[n,e,m,r,i]}class At extends X{constructor(t){super(),J(this,t,vt,_t,V,{data:2})}}export{At as component};
